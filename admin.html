<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل ادمین</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            background-color: #f3f4f6;
        }
        .admin-card {
            transition: transform 0.3s ease;
        }
        .admin-card:hover {
            transform: translateY(-3px);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-gray-800 text-white p-4 sticky top-0 z-10">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">پنل ادمین</h1>
            <a href="index.html" class="text-sm bg-gray-700 px-3 py-1 rounded hover:bg-gray-600">بازگشت به فروشگاه</a>
        </div>
    </nav>

    <!-- Admin Section -->
    <section class="container mx-auto py-8 px-4">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">مدیریت محصولات</h2>
        <form id="productForm" class="bg-white p-6 rounded-lg shadow-md mb-8">
            <input type="hidden" id="productId">
            <div class="mb-4">
                <label for="productName" class="block text-sm font-medium text-gray-700">نام محصول</label>
                <input type="text" id="productName" class="mt-1 block w-full border rounded p-2" required>
            </div>
            <div class="mb-4">
                <label for="productDescription" class="block text-sm font-medium text-gray-700">توضیحات</label>
                <textarea id="productDescription" class="mt-1 block w-full border rounded p-2" required></textarea>
            </div>
            <div class="mb-4">
                <label for="productPrice" class="block text-sm font-medium text-gray-700">قیمت (تومان)</label>
                <input type="number" id="productPrice" class="mt-1 block w-full border rounded p-2" required>
            </div>
            <div class="mb-4">
                <label for="productImage" class="block text-sm font-medium text-gray-700">تصویر محصول</label>
                <input type="file" id="productImage" accept="image/*" class="mt-1 block w-full">
            </div>
            <button type="submit" id="submitButton" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">افزودن محصول</button>
        </form>
        <h3 class="text-xl font-semibold mb-4 text-gray-800">لیست محصولات</h3>
        <div id="adminProductList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Admin products will be loaded here -->
        </div>
    </section>

    <script>
        // Initialize Parse
        Parse.initialize("YOUR_APP_ID", "YOUR_JAVASCRIPT_KEY");
        Parse.serverURL = 'https://parseapi.back4app.com/';

        // Load Products for Admin
        async function loadAdminProducts() {
            const Product = Parse.Object.extend("Product");
            const query = new Parse.Query(Product);
            try {
                const results = await query.find();
                const adminProductList = document.getElementById('adminProductList');
                adminProductList.innerHTML = '';
                results.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'admin-card bg-white rounded-lg shadow-md p-4 flex flex-col';
                    card.innerHTML = `
                        <img src="${product.get('image')?.url() || 'https://via.placeholder.com/150'}" alt="${product.get('name')}" class="w-full h-32 object-cover rounded">
                        <h3 class="text-lg font-semibold mt-2 text-gray-800">${product.get('name')}</h3>
                        <p class="text-gray-600 text-sm">${product.get('description')}</p>
                        <p class="text-blue-600 font-bold mt-2">${product.get('price').toLocaleString()} تومان</p>
                        <div class="mt-4 flex space-x-2">
                            <button onclick="editProduct('${product.id}')" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">ویرایش</button>
                            <button onclick="deleteProduct('${product.id}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">حذف</button>
                        </div>
                    `;
                    adminProductList.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading admin products:', error);
            }
        }

        // Add/Edit Product
        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('productId').value;
            const name = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const imageFile = document.getElementById('productImage').files[0];

            const Product = Parse.Object.extend("Product");
            let product;

            if (productId) {
                // Edit existing product
                product = await new Parse.Query(Product).get(productId);
            } else {
                // Add new product
                product = new Product();
            }

            product.set('name', name);
            product.set('description', description);
            product.set('price', price);

            if (imageFile) {
                const parseFile = new Parse.File(imageFile.name, imageFile);
                await parseFile.save();
                product.set('image', parseFile);
            }

            try {
                await product.save();
                alert(productId ? 'محصول ویرایش شد' : 'محصول اضافه شد');
                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('submitButton').textContent = 'افزودن محصول';
                loadAdminProducts();
            } catch (error) {
                console.error('Error saving product:', error);
                alert('خطا در ذخیره محصول');
            }
        });

        // Edit Product
        async function editProduct(id) {
            const Product = Parse.Object.extend("Product");
            const query = new Parse.Query(Product);
            try {
                const product = await query.get(id);
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.get('name');
                document.getElementById('productDescription').value = product.get('description');
                document.getElementById('productPrice').value = product.get('price');
                document.getElementById('submitButton').textContent = 'ویرایش محصول';
            } catch (error) {
                console.error('Error fetching product:', error);
            }
        }

        // Delete Product
        async function deleteProduct(id) {
            if (confirm('آیا مطمئن هستید که می‌خواهید این محصول را حذف کنید؟')) {
                const Product = Parse.Object.extend("Product");
                const query = new Parse.Query(Product);
                try {
                    const product = await query.get(id);
                    await product.destroy();
                    alert('محصول حذف شد');
                    loadAdminProducts();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('خطا در حذف محصول');
                }
            }
        }

        // Initial Load
        loadAdminProducts();
    </script>
</body>
</html>
